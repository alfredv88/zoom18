<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Vista de lista para reuniones Zoom -->
    <record id="view_zoom_meeting_tree" model="ir.ui.view">
        <field name="name">zoom.meeting.tree</field>
        <field name="model">zoom.meeting</field>
        <field name="arch" type="xml">
            <list string="Reuniones Zoom" 
                  default_order="start_time desc"
                  multi_edit="1"
                  create="true"
                  edit="true"
                  delete="true">
                
                <!-- Columna principal con nombre y estado -->
                <field name="name" string="Reunión" widget="text"/>
                <field name="status" string="Estado" widget="badge"/>
                
                <!-- Información de tiempo -->
                <field name="start_time" string="Inicio" widget="datetime"/>
                <field name="duration" string="Duración (min)" widget="integer"/>
                
                <!-- Estadísticas de participación -->
                <field name="total_invited" string="Invitados" widget="integer"/>
                <field name="total_confirmed" string="Confirmados" widget="integer"/>
                <field name="attendance_rate" string="Tasa (%)" widget="progressbar"/>
                
                <!-- Información del proyecto -->
                <field name="project_id" string="Proyecto" widget="many2one"/>
                <field name="task_id" string="Tarea" widget="many2one"/>
                
                <!-- Botones contextuales según el estado -->
                <button name="action_start_meeting" string="▶️ Iniciar" type="object" 
                        class="btn-success" icon="fa-play" 
                        invisible="status != 'scheduled' or not start_url"
                        help="Iniciar reunión"/>
                        
                <button name="action_join_meeting" string="🔗 Unirse" type="object" 
                        class="btn-primary" icon="fa-sign-in" 
                        invisible="not join_url"
                        help="Unirse a la reunión"/>
                        
                <button name="action_copy_join_url" string="📋 URL" type="object" 
                        class="btn-info" icon="fa-copy" 
                        invisible="not join_url"
                        help="Copiar URL de unirse"/>
                        
                <button name="action_view_attendees" string="👥 Asistentes" type="object" 
                        class="btn-secondary" icon="fa-users" 
                        invisible="not attendee_ids"
                        help="Ver asistentes"/>
                        
                <button name="action_send_invitations" string="📧 Invitar" type="object" 
                        class="btn-warning" icon="fa-envelope" 
                        invisible="not attendee_ids or status == 'cancelled'"
                        help="Enviar invitaciones"/>
                        
                <button name="action_cancel_meeting" string="❌ Cancelar" type="object" 
                        class="btn-danger" icon="fa-times" 
                        invisible="status in ['finished', 'cancelled']"
                        help="Cancelar reunión"/>
            </list>
        </field>
    </record>

    <!-- Vista de formulario para reuniones Zoom -->
    <record id="view_zoom_meeting_form" model="ir.ui.view">
        <field name="name">zoom.meeting.form</field>
        <field name="model">zoom.meeting</field>
        <field name="arch" type="xml">
            <form string="Reunión Zoom">
                <header>
                    <!-- Botones principales según el estado -->
                    <button name="action_start_meeting" string="▶️ Iniciar Reunión" type="object" 
                            class="btn-primary" invisible="not start_url or status != 'scheduled'"
                            icon="fa-play"/>
                    <button name="action_join_meeting" string="🔗 Unirse a Reunión" type="object" 
                            class="btn-success" invisible="not join_url"
                            icon="fa-sign-in"/>
                    <button name="action_cancel_meeting" string="❌ Cancelar" type="object" 
                            class="btn-danger" invisible="status in ['finished', 'cancelled']"
                            icon="fa-times"/>
                    
                    <!-- Menú desplegable para acciones adicionales -->
                    <button name="action_add_attendee" string="👥 Agregar Asistente" type="object" 
                            class="btn-info" invisible="status == 'cancelled'"
                            icon="fa-user-plus"/>
                    <button name="action_send_invitations" string="📧 Enviar Invitaciones" type="object" 
                            class="btn-warning" invisible="not attendee_ids or status == 'cancelled'"
                            icon="fa-envelope"/>
                    <button name="action_mark_all_attended" string="✅ Marcar Todos Asistieron" type="object" 
                            class="btn-success" invisible="status != 'finished'"
                            icon="fa-check"/>
                    
                    <!-- Barra de estado con colores -->
                    <field name="status" widget="statusbar" 
                           statusbar_visible="scheduled,active,finished"
                           statusbar_colors='{"scheduled": "info", "active": "success", "finished": "muted", "cancelled": "danger"}'/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="action_start_meeting" type="object" class="oe_stat_button o_zoom_stat_btn" icon="fa-video-camera">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_value">
                                    <field name="status" widget="badge"/>
                                </span>
                                <span class="o_stat_text">Estado</span>
                            </div>
                        </button>
                        <button name="action_view_attendees" type="object" class="oe_stat_button o_zoom_stat_btn" icon="fa-users">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_value">
                                    <field name="total_invited"/>
                                </span>
                                <span class="o_stat_text">Invitados</span>
                            </div>
                        </button>
                        <button name="action_view_attendees" type="object" class="oe_stat_button o_zoom_stat_btn" icon="fa-check-circle">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_value">
                                    <field name="total_confirmed"/>
                                </span>
                                <span class="o_stat_text">Confirmados</span>
                            </div>
                        </button>
                        <button name="action_view_attendees" type="object" class="oe_stat_button o_zoom_stat_btn" icon="fa-user-check">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_value">
                                    <field name="total_attended"/>
                                </span>
                                <span class="o_stat_text">Asistieron</span>
                            </div>
                        </button>
                        <button name="action_copy_join_url" type="object" class="oe_stat_button o_zoom_stat_btn" icon="fa-copy">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_value">
                                    <i class="fa fa-copy"/>
                                </span>
                                <span class="o_stat_text">Copiar URL</span>
                            </div>
                        </button>
                    </div>
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Nombre de la reunión..."/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="start_time"/>
                            <field name="end_time" readonly="1"/>
                            <field name="duration"/>
                            <field name="task_id"/>
                            <field name="project_id" readonly="1"/>
                        </group>
                        <group>
                            <field name="meeting_id" readonly="1"/>
                            <field name="join_url" readonly="1" widget="url"/>
                            <field name="start_url" readonly="1" widget="url"/>
                            <field name="zoom_created" readonly="1"/>
                        </group>
                    </group>
                    <group string="Acciones de Copia">
                        <group>
                            <button name="action_copy_join_url" string="📋 Copiar URL Unirse" type="object" 
                                    class="btn-info" invisible="not join_url"/>
                            <button name="action_copy_start_url" string="📋 Copiar URL Iniciar" type="object" 
                                    class="btn-info" invisible="not start_url"/>
                        </group>
                        <group>
                            <button name="action_copy_meeting_id" string="📋 Copiar Meeting ID" type="object" 
                                    class="btn-info" invisible="not meeting_id"/>
                            <button name="action_copy_all_urls" string="📋 Copiar Todo" type="object" 
                                    class="btn-warning" invisible="not join_url and not start_url and not meeting_id"/>
                        </group>
                    </group>
                    <group>
                        <group>
                            <field name="expected_participants"/>
                            <field name="actual_participants"/>
                        </group>
                        <group>
                            <field name="participants" placeholder="Lista de participantes (emails separados por comas)..."/>
                        </group>
                    </group>
                    <group>
                        <field name="description" placeholder="Descripción detallada de la reunión..."/>
                    </group>
                    <group>
                        <field name="notes" placeholder="Observaciones adicionales..."/>
                    </group>
                    <group>
                        <field name="last_sync" readonly="1"/>
                    </group>
                    
                    <!-- Pestaña de Control de Información -->
                    <notebook>
                        <page string="Asistentes" name="attendees">
                            <group>
                                <group string="Estadísticas de Asistencia">
                                    <field name="total_invited" readonly="1"/>
                                    <field name="total_confirmed" readonly="1"/>
                                    <field name="total_attended" readonly="1"/>
                                    <field name="attendance_rate" readonly="1"/>
                                </group>
                                <group string="Acciones">
                                    <button name="action_add_attendee" string="Agregar Asistente" type="object" 
                                            class="btn-primary" invisible="status == 'cancelled'"/>
                                    <button name="action_send_invitations" string="Enviar Invitaciones" type="object" 
                                            class="btn-warning" invisible="not attendee_ids or status == 'cancelled'"/>
                                    <button name="action_send_reminders" string="Enviar Recordatorios" type="object" 
                                            class="btn-info" icon="fa-bell" invisible="not attendee_ids or status == 'cancelled'"/>
                                    <button name="action_send_meeting_summary" string="Enviar Resumen" type="object" 
                                            class="btn-secondary" icon="fa-file-text" invisible="not meeting_summary or status != 'finished'"/>
                                    <button name="action_mark_all_attended" string="Marcar Todos Asistieron" type="object" 
                                            class="btn-success" invisible="status != 'finished'"/>
                                </group>
                            </group>
                            <field name="attendee_ids" readonly="1"/>
                        </page>
                        
                        <page string="Tiempo Real" name="real_time">
                            <group>
                                <group string="Tiempos Programados">
                                    <field name="start_time"/>
                                    <field name="end_time" readonly="1"/>
                                    <field name="duration" readonly="1"/>
                                </group>
                                <group string="Tiempos Reales">
                                    <field name="actual_start_time" readonly="1"/>
                                    <field name="actual_end_time" readonly="1"/>
                                    <field name="meeting_duration" readonly="1"/>
                                    <field name="total_meeting_time" readonly="1"/>
                                </group>
                            </group>
                            <div class="oe_button_box" name="time_buttons">
                                <button name="action_start_meeting_real" string="Iniciar Reunión Real" type="object" 
                                        class="btn-primary" invisible="actual_start_time"/>
                                <button name="action_end_meeting_real" string="Finalizar Reunión Real" type="object" 
                                        class="btn-danger" invisible="not actual_start_time or actual_end_time"/>
                            </div>
                            <div class="alert alert-info" role="alert" invisible="not actual_start_time">
                                <strong>Reunión en curso desde:</strong> <field name="actual_start_time" readonly="1"/>
                            </div>
                            <div class="alert alert-success" role="alert" invisible="not actual_end_time">
                                <strong>Reunión finalizada:</strong> <field name="actual_end_time" readonly="1"/>
                                <br/><strong>Duración total:</strong> <field name="meeting_duration" readonly="1"/> minutos
                            </div>
                        </page>
                        
                        <page string="Control de Información" name="info_control">
                            <group>
                                <group string="Participantes">
                                    <field name="collaborators" placeholder="Colaboradores externos..."/>
                                    <field name="internal_personnel" placeholder="Personal interno..."/>
                                </group>
                                <group string="Información de Sesión">
                                    <field name="session_url" readonly="1"/>
                                    <field name="meeting_summary" placeholder="Resumen de la reunión..."/>
                                </group>
                            </group>
                            <group>
                                <field name="action_items" placeholder="Elementos de acción y tareas..."/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                
                <!-- Estilos CSS personalizados para el formulario -->
                <style>
                    /* Botones de estadísticas personalizados */
                    .o_zoom_stat_btn {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        border: none;
                        color: white;
                        transition: all 0.3s ease;
                    }
                    
                    .o_zoom_stat_btn:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                    }
                    
                    .o_zoom_stat_btn .o_stat_value {
                        color: white;
                        font-weight: bold;
                        font-size: 18px;
                    }
                    
                    .o_zoom_stat_btn .o_stat_text {
                        color: rgba(255,255,255,0.9);
                        font-size: 12px;
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                    }
                    
                    /* Mejorar la apariencia de los campos */
                    .o_form_view .o_form_label {
                        font-weight: 600;
                        color: #2c3e50;
                    }
                    
                    /* Estilo para la barra de estado */
                    .o_statusbar_status {
                        border-radius: 20px;
                        overflow: hidden;
                    }
                    
                    /* Mejorar las pestañas */
                    .o_notebook .nav-tabs .nav-link {
                        border-radius: 8px 8px 0 0;
                        font-weight: 500;
                        color: #6c757d;
                    }
                    
                    .o_notebook .nav-tabs .nav-link.active {
                        background: #2D8CFF;
                        color: white;
                        border-color: #2D8CFF;
                    }
                    
                    /* Estilo para los grupos de campos */
                    .o_group {
                        background: #f8f9fa;
                        border-radius: 8px;
                        padding: 15px;
                        margin-bottom: 15px;
                    }
                    
                    /* Mejorar los botones de acción */
                    .o_form_statusbar .btn {
                        border-radius: 20px;
                        font-weight: 500;
                        padding: 8px 16px;
                        margin: 0 5px;
                    }
                    
                    /* Estilo para campos de solo lectura */
                    .o_field_widget[readonly="1"] {
                        background: #e9ecef;
                        border-radius: 4px;
                        padding: 8px;
                    }
                    
                    /* Mejorar la apariencia de los campos de URL */
                    .o_field_url {
                        font-family: 'Courier New', monospace;
                        background: #f8f9fa;
                        border: 1px solid #dee2e6;
                        border-radius: 4px;
                        padding: 8px;
                    }
                </style>
            </form>
        </field>
    </record>

    <!-- Vista de búsqueda para reuniones Zoom -->
    <record id="view_zoom_meeting_search" model="ir.ui.view">
        <field name="name">zoom.meeting.search</field>
        <field name="model">zoom.meeting</field>
        <field name="arch" type="xml">
            <search string="Buscar Reuniones Zoom">
                <field name="name"/>
                <field name="description"/>
                <field name="participants"/>
                <field name="collaborators"/>
                <field name="internal_personnel"/>
                <field name="task_id"/>
                <field name="project_id"/>
                <field name="meeting_id"/>
                <separator/>
                <!-- Filtros por Estado -->
                <filter string="Programadas" name="scheduled" domain="[('status', '=', 'scheduled')]"/>
                <filter string="En Curso" name="active" domain="[('status', '=', 'active')]"/>
                <filter string="Finalizadas" name="finished" domain="[('status', '=', 'finished')]"/>
                <filter string="Canceladas" name="cancelled" domain="[('status', '=', 'cancelled')]"/>
                <separator/>
                <!-- Filtros por Fecha -->
                <filter string="Hoy" name="today" domain="[('start_time', '>=', datetime.datetime.combine(context_today(), datetime.time(0,0,0))), ('start_time', '&lt;=', datetime.datetime.combine(context_today(), datetime.time(23,59,59)))]"/>
                <filter string="Esta Semana" name="this_week" domain="[('start_time', '>=', (context_today() - datetime.timedelta(days=context_today().weekday())).strftime('%Y-%m-%d')), ('start_time', '&lt;=', (context_today() + datetime.timedelta(days=6-context_today().weekday())).strftime('%Y-%m-%d'))]"/>
                <filter string="Este Mes" name="this_month" domain="[('start_time', '>=', datetime.datetime.combine(context_today().replace(day=1), datetime.time(0,0,0)))]"/>
                <filter string="Próximas 24h" name="next_24h" domain="[('start_time', '>=', datetime.datetime.now()), ('start_time', '&lt;=', datetime.datetime.now() + datetime.timedelta(hours=24))]"/>
                <separator/>
                <!-- Filtros por Participantes -->
                <filter string="Con Participantes" name="with_participants" domain="[('participants', '!=', False)]"/>
                <filter string="Sin Participantes" name="without_participants" domain="[('participants', '=', False)]"/>
                <filter string="Con Asistentes" name="with_attendees" domain="[('total_invited', '>', 0)]"/>
                <filter string="Con Confirmaciones" name="with_confirmations" domain="[('total_confirmed', '>', 0)]"/>
                <filter string="Alta Asistencia" name="high_attendance" domain="[('attendance_rate', '>=', 80)]"/>
                <filter string="Baja Asistencia" name="low_attendance" domain="[('attendance_rate', '&lt;', 50)]"/>
                <separator/>
                <!-- Filtros por Tiempo Real -->
                <filter string="Con Tiempo Real" name="with_real_time" domain="[('actual_start_time', '!=', False)]"/>
                <filter string="Sin Tiempo Real" name="without_real_time" domain="[('actual_start_time', '=', False)]"/>
                <filter string="Con Duración Real" name="with_real_duration" domain="[('meeting_duration', '>', 0)]"/>
                <separator/>
                <!-- Filtros por Información -->
                <filter string="Con Colaboradores" name="with_collaborators" domain="[('collaborators', '!=', False)]"/>
                <filter string="Con Personal Interno" name="with_internal" domain="[('internal_personnel', '!=', False)]"/>
                <filter string="Con Resumen" name="with_summary" domain="[('meeting_summary', '!=', False)]"/>
                <filter string="Con Elementos de Acción" name="with_action_items" domain="[('action_items', '!=', False)]"/>
                <separator/>
                <!-- Filtros por Zoom -->
                <filter string="Creadas en Zoom" name="created_in_zoom" domain="[('zoom_created', '=', True)]"/>
                <filter string="Con URLs" name="with_urls" domain="[('join_url', '!=', False)]"/>
                <filter string="Con Meeting ID" name="with_meeting_id" domain="[('meeting_id', '!=', False)]"/>
                <group expand="0" string="Agrupar Por">
                    <filter string="Estado" name="group_status" context="{'group_by': 'status'}"/>
                    <filter string="Proyecto" name="group_project" context="{'group_by': 'project_id'}"/>
                    <filter string="Tarea" name="group_task" context="{'group_by': 'task_id'}"/>
                    <filter string="Participantes" name="group_participants" context="{'group_by': 'expected_participants'}"/>
                    <filter string="Fecha" name="group_date" context="{'group_by': 'start_time:day'}"/>
                    <filter string="Mes" name="group_month" context="{'group_by': 'start_time:month'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Vista de lista compacta para dashboard -->
    <record id="view_zoom_meeting_tree_compact" model="ir.ui.view">
        <field name="name">zoom.meeting.tree.compact</field>
        <field name="model">zoom.meeting</field>
        <field name="arch" type="xml">
            <list string="Reuniones Recientes" 
                  default_order="start_time desc"
                  limit="10">
                <field name="name" string="Reunión"/>
                <field name="start_time" string="Inicio"/>
                <field name="status" string="Estado"/>
                <field name="total_invited" string="Invitados"/>
                <field name="total_confirmed" string="Confirmados"/>
                <field name="attendance_rate" string="Tasa (%)"/>
                <button name="action_copy_join_url" string="Copiar URL" type="object" 
                        class="btn-info" icon="fa-copy" invisible="not join_url"/>
            </list>
        </field>
    </record>

    <!-- Acciones de ventana -->
    <record id="action_zoom_meeting" model="ir.actions.act_window">
        <field name="name">Reuniones Zoom</field>
        <field name="res_model">zoom.meeting</field>
        <field name="view_mode">list,form</field>
        <field name="search_view_id" ref="view_zoom_meeting_search"/>
        <field name="context">{}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                ¡Crea tu primera reunión Zoom!
            </p>
            <p>
                Las reuniones Zoom te permiten conectarte con tu equipo directamente desde Odoo.
            </p>
        </field>
    </record>

    <!-- Las acciones de filtros específicos se pueden usar desde la vista de búsqueda -->

    <!-- Menú principal -->
    <menuitem id="menu_zoom_main" 
              name="Zoom" 
              sequence="10" 
              web_icon="zoom18,static/description/icon.png"/>

    <!-- Menú dashboard se define en zoom_dashboard_views.xml -->

    <!-- Menú principal de reuniones -->
    <menuitem id="menu_zoom_meetings"
              name="Reuniones"
              parent="menu_zoom_main"
              action="action_zoom_meeting"
              sequence="20"/>


    <!-- Acción para reuniones activas -->
    <record id="action_active_meetings" model="ir.actions.act_window">
        <field name="name">Reuniones Activas</field>
        <field name="res_model">zoom.meeting</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[('status', '=', 'active')]</field>
        <field name="context">{}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                ¡Crea tu primera reunión activa!
            </p>
            <p>
                Las reuniones activas son aquellas que están en curso.
            </p>
        </field>
    </record>

    <!-- Otros menús se definen en zoom_dashboard_views.xml -->


</odoo>
